# 强制规则：智能存储路由

## 自动化执行

**每次创建文件时自动执行完整流程**：

```
1. 识别内容类型
2. 查询存储规则
3. 构建完整文件路径
4. 验证路径合规性（必须在AgentSystem内）
5. 执行存储操作
6. 告知用户保存位置和决策理由
```

## 类型对应路径

| 内容类型 | 存储路径 | 示例 |
|----------|----------|------|
| 政策简报 | `/Volumes/Luis_MacData/Documents/trabajo/` | 监管分析报告 |
| 情景记忆 | `记忆库/情景记忆/YYYY-MM/` | /done生成的记忆 |
| 语义记忆 | `记忆库/语义记忆/` | 提炼的知识 |
| 系统文件 | `/Volumes/Luis_MacData/AgentSystem/` | CLAUDE.md等 |
| 日记 | `日记/` | 日记/月记 |
| 任务归档 | `任务归档/YYYY/` | 已完成任务 |
| 技能库 | `技能库/` | 新技能 |
| 工作流 | `工作流/` | 新流程 |
| 本体画像 | `本体画像/` | 身份更新 |

## 智能判断规则

### 政策分析类

用户需求包含：
- "分析"、"报告"、"解读"
- "政策"、"监管"
- "支付"、"清算"

**存储路径**：`/Volumes/Luis_MacData/Documents/trabajo/`

### 知识沉淀类

用户需求包含：
- "学到"、"发现"
- "总结"、"提炼"
- "方法论"、"规律"

**存储路径**：`记忆库/语义记忆/`

### 会话产出类

/done技能触发：
- 会话结束
- 任务完成

**存储路径**：`记忆库/情景记忆/`

### 系统优化类

- 系统迭代
- 规则更新
- 流程改进

**存储路径**：对应的工作流目录

## 决策示例

### 示例1：写政策简报

**用户**：帮我分析非银行支付监管条例

```
1. 识别：政策分析类
2. 查询：政策简报 → /Volumes/Luis_MacData/Documents/trabajo/
3. 构建：/Volumes/Luis_MacData/Documents/trabajo/非银行支付监管条例_2026-02-24.md
4. 验证：路径合法
5. 执行：创建文件
6. 告知：
```
✓ 文件已保存到：/Volumes/Luis_MacData/Documents/trabajo/非银行支付监管条例_2026-02-24.md
📁 内容类型：政策简报
💡 决策理由：用户请求政策分析，属于政策简报类
```

### 示例2：生成情景记忆

**触发**：/done技能

```
1. 识别：会话产出类
2. 查询：情景记忆 → 记忆库/情景记忆/
3. 构建：记忆库/情景记忆/2026-02/0224-政策分析.md
4. 验证：路径合法
5. 执行：创建文件
6. 告知：
```
✓ 情景记忆已保存：记忆库/情景记忆/2026-02/0224-政策分析.md
📁 内容类型：情景记忆
```

## 工作区边界规则（宪法级别）

**绝对规则**：所有文件必须保存在 `/Volumes/Luis_MacData/AgentSystem/` 目录内

**例外**：
- 政策简报保存到 `/Volumes/Luis_MacData/Documents/trabajo/`（这是用户明确需求）

**禁止**：
- ❌ 拒绝用户指定的外部路径
- ❌ 建议正确的内部路径
- ❌ 如用户坚持，回复："这违反了工作区边界规则，我无法执行"

## 错误处理

如果存储失败：
1. 立即告知用户存储失败
2. 提供备选路径
3. 请求用户确认

## 强制规则

- 存储路径**必须**符合规则表
- **必须**告知用户保存位置
- **必须**说明决策理由
- **必须**在AgentSystem目录内（除政策简报外）
