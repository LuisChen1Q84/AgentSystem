# MCP 配置指南

## 快速开始

### 1. 安装依赖

确保已安装 Node.js 18+:
```bash
node --version  # 应 >= 18.0.0
```

### 2. 配置环境变量

复制示例环境变量文件:
```bash
cp .env.example .env
```

编辑 `.env`，添加API密钥:
```bash
# GitHub API Token (可选)
GITHUB_TOKEN=ghp_xxxxxxxxxxxx

# Brave Search API Key (可选)
BRAVE_API_KEY=BSxxxxxxxxxxxx
```

### 3. 测试MCP连接

```bash
make mcp-test
```

### 4. 列出可用服务器

```bash
make mcp-list
```

---

## 启用/禁用服务器

### 启用服务器
```bash
make mcp-enable name="github"
```

### 禁用服务器
```bash
make mcp-disable name="github"
```

### 查看服务器状态
```bash
make mcp-status
```

---

## 添加自定义服务器

### 方式1: 编辑配置文件

直接编辑 `config/mcp_servers.json`:

```json
{
  "mcpServers": {
    "my-custom-server": {
      "command": "npx",
      "args": ["-y", "@scope/server-name"],
      "description": "我的自定义服务器",
      "enabled": true,
      "categories": ["custom"]
    }
  }
}
```

### 方式2: 使用命令

```bash
make mcp-add \
  name="my-server" \
  package="@scope/server-name" \
  enabled="true"
```

---

## 安全最佳实践

1. **API密钥管理**
   - 永远不要将API密钥提交到Git
   - 使用 `.env` 文件存储敏感信息
   - 定期轮换API密钥

2. **文件系统边界**
   - filesystem服务器只能访问AgentSystem目录
   - 如需访问其他目录，需显式配置

3. **网络访问控制**
   - 使用 `FETCH_DOMAIN_WHITELIST` 限制可访问的域名
   - 避免访问内部网络资源

4. **命令执行限制**
   - 禁止执行危险命令（rm -rf, format等）
   - 敏感操作需要用户确认

---

## 故障排查

### 问题: npx命令找不到

**解决**: 安装Node.js 18+
```bash
brew install node
```

### 问题: 服务器启动失败

**排查步骤**:
1. 检查 `config/mcp_servers.json` 语法
2. 查看日志 `日志/mcp/mcp_calls.log`
3. 手动测试: `npx -y @modelcontextprotocol/server-filesystem /path`

### 问题: API认证失败

**解决**:
1. 检查 `.env` 文件是否存在
2. 确认API密钥有效
3. 重启MCP客户端

---

## 参考链接

- [MCP官方文档](https://modelcontextprotocol.io/)
- [MCP服务器列表](https://github.com/modelcontextprotocol/servers)
- [配置示例](https://github.com/modelcontextprotocol/quickstart-resources)
